
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Sanjay Bhagia&#x27;s Blog</title>
        <meta name="description" content="Sanjay Bhagia" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link type="application/rss+xml" rel="alternate" title="Sanjay Bhagia&#x27;s Blog" href="/rss.xml" />
                <link type="application/atom+xml" rel="alternate" title="Sanjay Bhagia&#x27;s Blog" href="/feed.xml" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Sanjay Bhagia&#x27;s Blog" />
        <meta name="msapplication-tooltip" content="Sanjay Bhagia&#x27;s Blog" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:site_name" content="Sanjay Bhagia&#x27;s Blog" />
        <meta property="og:title" content="" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://sanjaybhagia.com/" />
        
        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>
        <script src="/assets/js/highlight.pack.js"></script>
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <!-- <script src="/assets/js/background-check.min.js"></script> -->
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Sanjay Bhagia&#x27;s Blog</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About Me</a></li>
<li><a href="/posts">Archive</a></li>
<li><a href="/tags">Tags</a></li>
<li><a href="/tools">Tools</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    <div class="site-heading">
        <h1>Sanjay Bhagia</h1>
                <hr class="small">
        <span class="subheading">This is my blog, where I write about stuff that interests me such as .NET, Azure, CI/CD and technology in general.</span>
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        
<div class="row">
    <div class="col-sm-8 right-border">
                <div class="post-preview">
                    <a href="/2019/02/microsoft-openhack-devops-stockholm">
                        <h2 class="post-title">Microsoft OpenHack DevOps - Stockholm</h2>
                    </a>
                    <p class="post-meta">Posted on Monday, 11 February 2019</p>
<!-- wp:paragraph -->
<p>Last week I participated in OpenHack DevOps organized by Microsoft in Stockholm. It was a three day event from 5th - 7th February 2019. The hackathon was focused on Azure DevOps. The format of the event was of-course like a hackathon. </p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Participants were divided into teams (4-6 each). The content was set as challenges (total 9). Every team (or two) had a coach - someone from Microsoft - who was helping and guiding during the challenges. We, as teams, were supposed to find our way out to solve the challenges. There was no one way, we were free to take our decisions and paths as deemed fit.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Here is the schedule and agenda for the event if you are curious: <a href="https://www.microsoftevents.com/profile/form/index.cfm?PKformID=0x5473274abcd" target="_blank" rel="noreferrer noopener" aria-label="Microsoft OpenHack DevOps (opens in a new tab)">Microsoft OpenHack DevOps</a></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>What I really liked about this event was that we were focused on a task at hand. It was a hands-on rather than attending any tech talk about a specific topic. The tasks were set, challenges were well organized, the environment was prepared, code was almost prepared (with some changes) so that we can focus on learning how we can use Azure DevOps as a tool to ensure zero down-time for production ready application. Kubernetes was chosen as an orchestration framework.</p>
<!-- /wp:paragraph -->
<!-- wp:pullquote -->
<figure class="wp-block-pullquote"><blockquote><p> Microsoft OpenHack is a developer focused event where a wide variety of participants (Open) learn through hands-on experimentation (Hack) using challenges based on real-world customer engagements designed to mimic the developer journey. </p></blockquote></figure>
<!-- /wp:pullquote -->
<!-- wp:paragraph -->
<p>For every challenge the links to documentation and resources were provided to understand relevant topics and areas at hand.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Besides the actual work, it was a great opportunity to network and discuss broader topics with fellow participants and Microsoft employees. They also had what they called the <strong>envisioning </strong>sessions which were basically to discuss with Microsoft guys one-on-one the challenges one is facing at his or her work.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Overall, I think it was a great learning experience with great focus on getting things done. I will definitely keep an eye on such events in the future. By the way, if you happen to be in Stockholm in April there is an upcoming <a rel="noreferrer noopener" aria-label="Microsoft Ignite Tour (opens in a new tab)" href="https://www.microsoft.com/sv-se/ignite-the-tour/stockholm" target="_blank">Microsoft Ignite Tour</a> that you must checkout.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Cheers</p>
<!-- /wp:paragraph -->
                </div>       
                    <hr /> 
                <div class="post-preview">
                    <a href="/2018/12/using-postman-for-integration-tests">
                        <h2 class="post-title">Using Postman for Integration Tests</h2>
                    </a>
                    <p class="post-meta">Posted on Tuesday, 11 December 2018</p>
<!-- wp:paragraph {"align":"left"} -->
<p>In my recent project, I'm providing some integration services (APIs) that are used by the web application to fetch data from source systems. This is a legacy project that I inherited. To be honest, this was a PoC and we all know how PoCs are developed and very often continue to be used in production. That is why I have been rewriting/refactoring this codebase (<a href="https://twitter.com/bhagiasanjay/status/1054740627978641410">I even tweeted about this a while ago</a>) in every sprint to improve the code quality and cleaning up a lot of code. Since I don't have a proper code coverage for all the source code, I'm always concerned when I'm continuously developing and refactoring this codebase. I'm often concerned (rightfully so) that I'll break my API and will eventually bring down the system due to some stupid mistake.  But until I can have a good enough code coverage I want to be confident that I'm not breaking my APIs whenever I'm pushing a new release to production. Now I've taken quite a lot of steps over past few months (from having proper CI/CD pipeline to having slots support to have the availability for new releases etc) to clean up the codebase and continue to have my services up-and-running, one thing I'm particularly excited about is Postman.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>If you are involved in RESTful API development, chances are you are already aware of Postman or <g class="gr_ gr_5 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="5" data-gr-id="5">atleast</g> have heard of it. But in case this is the first time you heard about the tool, I'll give you a very quick intro about it.&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:pullquote {"align":"center","className":"aligncenter"} -->
<blockquote class="blockquote">
<p>&quot;Postman mkes API Development Simple&quot;
<a href="'https://www.getpostman.com%27"><em>Postman website</em></a></p>
</blockquote>
<!-- <figure class="wp-block-pullquote aligncenter"><blockquote><p>"Postman Makes API Development Simple"</p><cite><a href="https://www.getpostman.com/" target="_blank">Postman website</a></cite></blockquote></figure> -->
<!-- /wp:pullquote -->
<!-- wp:paragraph -->
<p>Postman is a powerful HTTP client for testing web services. It makes API development faster, easier and better. You can read more about it on their official <a href="https://www.getpostman.com">website</a></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>I've been using postman during my development (testing APIs etc) but for last few weeks, I've started to write integration tests for my APIs so that whenever I'm making any changes or creating a new release (for any environment), I can quickly run the collection and make sure everything is still functioning as expected.&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>This is not a replacement <g class="gr_ gr_63 gr-alert sel gr_gramm gr_replaced gr_inline_cards gr_disable_anim_appear Grammar multiReplace" id="63" data-gr-id="63">for</g> having a proper unit test (with good enough code coverage) but I find it very useful to quickly verify that I&nbsp;haven't broken the core functionality of my solution.&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Here are some features I'm using with Postman for my integration tests</p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul><li>Test automation<ul><li>Collections<ul><li>One big collection to run tests for all services in one go</li></ul></li><li>Separate collections for each service (API) with calls of each operation that API exposes/supports</li><li>Extended tests to cover different scenarios</li></ul></li><li>Debugging<ul><li>&nbsp;Pre-script and tests for individual calls</li></ul></li><li>Environment variables - to have the possibility to test the APIs towards&nbsp;any environment that I want to test&nbsp;</li></ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>Even though I've used quite a few features so far but it doesn't end here. Here is what I have planned to take advantage of other features as I go along.&nbsp;<br></p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul><li>Integrating postman in my CI/CD (<g class="gr_ gr_3 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="3" data-gr-id="3">newman</g>) so that I can&nbsp;auto swap&nbsp;my slots for the web application if everything is green</li><li>Mocking</li><li>Continue to extend my tests cases to increase coverage<br></li></ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>How are you using Postman in your projects? Have you found anything intersting/useful that you would like to share?</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Cheers</p>
<!-- /wp:paragraph -->
                </div>       
                    <hr /> 
                <div class="post-preview">
                    <a href="/2018/11/accessing-wcf-service-via-azure-service-bus-relay-with-net-core">
                        <h2 class="post-title">Accessing WCF Service via Azure Service Bus Relay with .NET Core</h2>
                    </a>
                    <p class="post-meta">Posted on Wednesday, 28 November 2018</p>
<!-- wp:paragraph {"ampFitText":true} -->
<p><amp-fit-text layout="fixed-height" min-font-size="14" max-font-size="48" height="50"><p><em><a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore" target="_blank" rel="noreferrer noopener" aria-label="Check out my GitHub repository if you want to dig into the source code directly. (opens in a new tab)">Check out my GitHub repository if you want to dig into the source code directly.</a></em></p></amp-fit-text></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>WCF (Windows Communication Foundation) has served us for a long time when it comes to talking to many LOB systems (SAP etc.). You might have love or hate (<em>though&nbsp;if I have to guess, it would be on hate side</em>) relationship with WCF but it works and at times we don't have any other choice. If you happen to be in a situation where you are talking to legacy systems via WCF, you most likely have a built an API layer on top of it to serve your clients. </p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>I was recently looking to consume WCF services using .NET Core <em>(with the intention that I can migrate my web application to .NET Core)</em>. Very quickly I came up to this <a href="https://github.com/dotnet/wcf" target="_blank" rel="noopener">GitHub&nbsp;repository</a> which was awesome. However, this .NET&nbsp;Core implementation is not in parity with the full framework yet.&nbsp; I tested it and it worked just fine with standard bindings (<g class="gr_ gr_7 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="7" data-gr-id="7">http</g>&nbsp;etc). <a href="https://twitter.com/spboyer" target="_blank" rel="noopener">Shane Boyer</a> has a good <a href="http://tattoocoder.com/asp-net-core-getting-clean-with-soap/" target="_blank" rel="noopener">blog post</a> on this topic if you want to see how to use this.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>As far as my needs (this particular scenario) are concerned, I couldn't get it to work for my setup.&nbsp;This is how the setup looks for me.&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>The web application (hosted in Azure Web App) talks to WCF Service (running on-premises, hosted in IIS) via Azure Service Bus Relay (in Azure)</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":673} -->
<figure class="wp-block-image"><img src="/images/image-21.png" alt="" class="wp-image-673"/></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>So basically, there is no equivalent to basicHttpRelayBinding <g class="gr_ gr_33 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="33" data-gr-id="33">in .</g>NET Core implementation yet and this is something my WCF service has to enable communication via Azure Service Bus Relay.&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>After discussing with a friend of mine, I got a suggestion to try it out with SOAP instead and it seems to work fine! I know it sounds a bit ironic that on the one hand I'm moving to the latest (and greatest) framework for my web application but at the same time, I'm going one step back and using SOAP protocol to make it work - well such is life. I would very much appreciate if anyone can point me to the better solution. but until then, let's continue forward.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>So, in this blog post<g class="gr_ gr_182 gr-alert sel gr_gramm gr_replaced gr_inline_cards gr_disable_anim_appear Punctuation only-ins replaceWithoutSep" id="182" data-gr-id="182">,</g> I will go through how did I manage to call WCF service from my .NET Core Web Application. Again,&nbsp;<a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore" target="_blank" rel="noreferrer noopener">here is the entire source code</a></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore" target="_blank" rel="noopener"></a>So this is what <g class="gr_ gr_17 gr-alert sel gr_spell gr_replaced gr_inline_cards gr_disable_anim_appear ContextualSpelling multiReplace" id="17" data-gr-id="17">I'm</g> going to do:&nbsp;</p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul><li>Create Azure Service Bus Relay (<a href="https://docs.microsoft.com/en-us/azure/service-bus-relay/service-bus-dotnet-hybrid-app-using-service-bus-relay" target="_blank">read here how to create this</a>)</li><li>Create a WCF Service (with Azure Service Bus Relay Binding) and publish this locally to run it on IIS</li><li>ASP.NET Core Web Application calling to WCF Service using HTTP Post SOAP request.</li></ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>Follow the link I have provided above to create the service bus relay. Let's start with WCF Service. Here is the <a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore/tree/master/WcfService" target="_blank">sample WCF <g class="gr_ gr_188 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Punctuation only-ins replaceWithoutSep" id="188" data-gr-id="188">project</g></a> I build for this demo.&nbsp; It's a very basic WCF service which has Azure Service Bus Relay binding besides standard HTTP&nbsp;binding (check out the <a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore/blob/master/WcfService/WcfService/Web.config" target="_blank">web.config</a> for binding details). I have deployed this in IIS on my local machine. You can clone the repository and add the details of your relay if you want to try it out yourself. It exposes the following contract, which I'm interested in.</p>
<!-- /wp:paragraph -->
<!-- wp:code -->
<pre class="wp-block-code"><code lang="clike" class="language-clike">[ServiceContract]
    public interface ICustomerService
    {
        [OperationContract]
        string GetCustomerData(string customerId);
    }</code></pre>
<!-- /wp:code -->
<!-- wp:paragraph -->
<p>When you&nbsp;browse&nbsp;this service from IIS you should see the service like this. At this point, a Service Bus WCF listener should also be registered in your namespace (you can check it in Azure Portal)</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":660} -->
<figure class="wp-block-image"><img src="/images/image-14.png" alt="" class="wp-image-660"/><figcaption>WCF Service deployed in IIS with Azure Service Relay Binding</figcaption></figure>
<!-- /wp:image -->
<!-- wp:image {"id":667} -->
<figure class="wp-block-image"><img src="/images/image-18.png" alt="" class="wp-image-667"/><figcaption>WCF Relay Registered from WCF Service</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Now, let's start with the web application. I have created a vanilla ASP.NET Core Web API project (2.1). You can grab the <a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore/tree/master/WebApplication" target="_blank" rel="noopener">source code from here </a>(and clone it if you want to try it out yourself). <em>Make sure you update settings in <g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="6" data-gr-id="6">appsettings.json</g> file for Azure Service Bus Relay. If you wish you publish this to Azure Web app - add these settings as Application Settings</em></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>After creating the project, I added following NuGet package</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><strong>Nuget Packages:&nbsp;</strong></p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul><li>Microsoft.Azure.ServiceBus</li></ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>In <strong>ValuesController</strong>, I have created a <em>GetCustomerData</em> method that takes in <em>customerId</em> as a string.&nbsp; In here, I'll make a call to WCF Service and return the response I receive from the service (<em>the WCF service returns a dummy response</em>)</p>
<!-- /wp:paragraph -->
<!-- wp:code -->
<pre class="wp-block-code"><code lang="clike" class="language-clike">[HttpGet("{customerId}")]
public async Task&lt;string> GetCustomerData(string customerId)</code></pre>
<!-- /wp:code -->
<!-- wp:paragraph -->
<p>Then moving forwards,&nbsp; I generate the token for Azur Service Bus Relay:</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":665,"linkDestination":"custom"} -->
<figure class="wp-block-image"><a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore/blob/master/WebApplication/WebApplication/Controllers/ValuesController.cs"><img src="/images/image-17.png" alt="" class="wp-image-665"/></a><figcaption>Generating Token for Service Bus Relay</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>With this information, I construct the HTTP Post request like this:</p>
<!-- /wp:paragraph -->
<!-- wp:github-gist-gutenberg-block/github-gist {"url":"https://gist.github.com/sanjaybhagia/569e348e1bdc9fd9a53c95d28cd0e56e"} -->
<script src="//gist.github.com/569e348e1bdc9fd9a53c95d28cd0e56e.js" type="text/javascript"></script>
<!-- <a href="https://gist.github.com/sanjaybhagia/569e348e1bdc9fd9a53c95d28cd0e56e" class="wp-block-github-gist-gutenberg-block-github-gist">View Gist on GitHub</a> -->
<!-- /wp:github-gist-gutenberg-block/github-gist -->
<!-- wp:paragraph -->
<p>We are basically making <g class="gr_ gr_49 gr-alert sel gr_gramm gr_replaced gr_inline_cards gr_disable_anim_appear Grammar multiReplace" id="49" data-gr-id="49">an</g> HTTP Post Request to the Service Bus Relay endpoint over SOAP. For this, we need to set up a few headers</p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul><li>ServiceBusAuthorization - <em>Relay Token retrieved earlier</em></li><li>SOAPAction - <em>The Operation you want to call from WCF Service</em></li><li>Accept header - <em>text/</em><g class="gr_ gr_117 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="117" data-gr-id="117">xml</g></li></ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>Lastly, we need to set the body for the request - since this is a SOAP call, we need a&nbsp;<g class="gr_ gr_3 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="3" data-gr-id="3">SOAP</g> message.</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":664,"linkDestination":"custom"} -->
<figure class="wp-block-image"><a href="https://github.com/sanjaybhagia/wcfservice-servicebusrelay-netcore/blob/master/WebApplication/WebApplication/Controllers/ValuesController.cs"><img src="/images/image-16.png" alt="" class="wp-image-664"/></a><figcaption>SOAP message body</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Press F5 and run the web application, pass in <g class="gr_ gr_130 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="130" data-gr-id="130"><g class="gr_ gr_137 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="137" data-gr-id="137">cusotmerId</g></g> parameter and you should get <g class="gr_ gr_138 gr-alert sel gr_gramm gr_replaced gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="138" data-gr-id="138">a </g>response from the service:</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":661} -->
<figure class="wp-block-image"><img src="/images/image-15.png" alt="" class="wp-image-661"/><figcaption>Successful response from WCF Service</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Have you tried to consume WCF Service from .NET Core application? How did it go for you? I would love to hear from you and would appreciate if you could suggest a&nbsp;better way of doing this as of today? I guess I don't need to tell you that I don't like using SOAP :)</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Cheers.</p>
<!-- /wp:paragraph -->
                </div>       
                    <hr /> 
                <div class="post-preview">
                    <a href="/2018/11/accessing-azure-analysis-services-models-using-net-core">
                        <h2 class="post-title">Accessing Azure Analysis Services Models using .NET Core</h2>
                    </a>
                    <p class="post-meta">Posted on Monday, 12 November 2018</p>
<!-- wp:quote {"className":"is-style-default"} -->
<blockquote class="wp-block-quote is-style-default"><p>Azure Analysis Services is a fully managed platform as a service (PaaS) that provides enterprise-grade data models in the cloud. Use advanced mashup and modeling features to combine data from multiple data sources, define metrics, and secure your data in a single, trusted tabular semantic data model. The data model provides an easier and faster way for users to browse massive amounts of data for ad-hoc data analysis.<br/></p><cite>Refer to <a href="https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-overview" target="_blank" rel="noreferrer noopener">Microsoft official documentation</a> to read more about Azure Analysis Services</cite></blockquote>
<!-- /wp:quote -->
<!-- wp:paragraph -->
<p>Programming against Analysis services is nothing new and we have been doing it for a long time with the full .NET framework, the most common approach is using ADOMD.Net. In this blog post, I will go through the process of getting the same task done with .NET Core.  For this sample, I'm using .NET Core 2.1.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><a href="https://github.com/sanjaybhagia/azure-analysis-services-netcore-sample" target="_blank">Look at my GitHub repository for the entire source code for this blogpost</a></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>The important thing to note here is that there is no official <g class="gr_ gr_4 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="4" data-gr-id="4">nuget</g> package from Microsoft for ADOMD.NET yet, but I found an unofficial package here (<a href="https://github.com/bdebaere/Unofficial.Microsoft.AnalysisServices.AdomdClientNetCore" target="_blank" rel="noopener">Unofficial.Microsoft.AnalysisServices.AdomdClientNetCore</a>) and it seems to work for my quick test (you have to make a call if you want to use it in production or not). I couldn't find any official word on this anywhere I looked for.  <em>Besides this </em><g class="gr_ gr_5 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="5" data-gr-id="5">nuget</g><em> package for .net core rest of the stuff should work same in full framework (with official </em><g class="gr_ gr_6 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="6" data-gr-id="6">nuget</g><em> for ADOMD.NET)</em></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>I have divided this into several steps so that it is easy to follow. So let's get started!</p>
<!-- /wp:paragraph -->
<!-- wp:heading -->
<h2>Step 1: Create Azure Analysis Service resource</h2>
<!-- /wp:heading -->
<!-- wp:paragraph -->
<p>The very first thing we need is the Analysis Server and model in Azure. Follow <a href="https://docs.microsoft.com/en-us/azure/analysis-services/analysis-services-create-server" target="_blank">this</a> quick starter to create the server.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Next is to create a model which we will use to query. You can create a model with sample data (adventure works) right from within your Analysis Server.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Click 'Manage' in the blade and click 'New Model'. Select 'Sample data' from the drop down and press 'Add'. It should add the model for you. </p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":598} -->
<figure class="wp-block-image"><img src="/images/image-3.png" alt="" class="wp-image-598"/><figcaption>Create a model Analysis Services</figcaption></figure>
<!-- /wp:image -->
<!-- wp:image {"id":597} -->
<figure class="wp-block-image"><img src="/images/image-2.png" alt="" class="wp-image-597"/><figcaption>Model successfully created</figcaption></figure>
<!-- /wp:image -->
<!-- wp:heading -->
<h2 id="mce_26">Step 2: Create App Service Principal</h2>
<!-- /wp:heading -->
<!-- wp:paragraph -->
<p>There are many ways to access analysis services. Simplest is <g class="gr_ gr_5 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="5" data-gr-id="5">usig</g> a connection string that has <g class="gr_ gr_12 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="12" data-gr-id="12">usrename</g> and password. But this is not recommended approach and works only with <g class="gr_ gr_209 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="209" data-gr-id="209">full .</g>Net framework but <g class="gr_ gr_14 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="14" data-gr-id="14">not .</g>Net Core (I was pointed by <a href="https://github.com/bdebaere/Unofficial.Microsoft.AnalysisServices.AdomdClientNetCore/issues/1" target="_blank">bdebaere in his GitHub respo</a> regarding this), so we want to authenticate with other OAuth flows. For this post, we will use token-based authentication. For <g class="gr_ gr_832 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="832" data-gr-id="832">this</g> we will need an app principal (or Azure AD App)</p>
<!-- /wp:paragraph -->
<!-- wp:list {"ordered":true} -->
<ol><li>Sign in to <a href="https://portal.azure.com/" target="_blank" rel="noreferrer noopener">Azure Portal</a>.</li><li>Navigate to Azure Active Directory -> App Registrations and Click New application registration.</li><li>Register an app with the following settings:<ul><li>Name: any name</li><li>Application type: Web app/API,</li><li>Sign-on URL:  https://westeurope.asazure.windows.net (<em>Not really important here, you can provide any valid <g class="gr_ gr_14 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="14" data-gr-id="14">url</g></em>).<br/></li></ul></li><li>Once the app is created, navigate to 'Keys' and add a new key<ul><li>provide the description and select duration and press Save button</li><li>after that you will be able to see the key <strong>it will appear only once</strong> so take note of this key and we will use this later on</li></ul></li><li><g class="gr_ gr_127 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="127" data-gr-id="127">Also</g> take note of the Application Id from the main page of the application</li></ol>
<!-- /wp:list -->
<!-- wp:image {"id":600} -->
<figure class="wp-block-image"><img src="/images/image-5.png" alt="" class="wp-image-600"/><figcaption>Setting access key for Azure AD App</figcaption></figure>
<!-- /wp:image -->
<!-- wp:heading -->
<h2 id="mce_12">Step 3: Assign your user as Service Admin in order to connect from SSMS</h2>
<!-- /wp:heading -->
<!-- wp:paragraph -->
<p>Registering an app is not enough. We need to assign access to this app on  Analysis Service Model (<em>adventureworks model that we created in previous step)</em>. In order to give this access, we will need SQL Server Management Studio. </p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Before we could use that, we need a way to connect to this analysis services instance via SSMS. For this, we need to set up our account as Service Admin. Navigate to the Analysis Services resource that we created in the first step. Click 'Analysis Services Admin'. Normally your subscription account is set as the admin (this is what I will be using) but you are free to set up <g class="gr_ gr_270 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="270" data-gr-id="270">any</g> account you wish appropriate. </p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":601} -->
<figure class="wp-block-image"><img src="/images/image-6.png" alt="" class="wp-image-601"/><figcaption>Setting Sevice Admin for Analysis Service</figcaption></figure>
<!-- /wp:image -->
<!-- wp:heading -->
<h2 id="mce_28">Step 4: Grant permissions to app principal on the model</h2>
<!-- /wp:heading -->
<!-- wp:list {"ordered":true} -->
<ol><li>Connect to Analysis Service using SSMS 2017 with your account that you assigned as Service Admin in the previous step<ul><li>You will need the Server name (from Step 1)</li></ul></li><li>Select the database model and click on Roles or add a new Role<ul><li>Choose any name </li><li>Select 'Read' database permission for the role </li></ul></li><li>Add the Service principal to any role in below format (search for the app name)</li></ol>
<!-- /wp:list -->
<!-- wp:image {"id":604} -->
<figure class="wp-block-image"><img src="/images/image-9.png" alt="" class="wp-image-604"/><figcaption>Connect to Azure Analysis Server with Service Admin account<br/></figcaption></figure>
<!-- /wp:image -->
<!-- wp:image {"id":612} -->
<figure class="wp-block-image"><img src="/images/image-13.png" alt="" class="wp-image-612"/><figcaption>Adding App principal as a member in newly defined role</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>This will add user with following convention:  app:&lt;appid>&#64;&lt;tenantid></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><em>appid</em>: is the application id for your app you created in <g class="gr_ gr_108 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Grammar only-del replaceWithoutSep" id="108" data-gr-id="108">the Step</g> 2.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><em>tenantid</em> - is the id of your subscription (you can find this in Properties of your Azure Active Directory)</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p><strong><em>This didn't work for me when I <g class="gr_ gr_32 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="32" data-gr-id="32">tried </g></em></strong><strong><em><g class="gr_ gr_32 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="32" data-gr-id="32"> to</g> use <g class="gr_ gr_29 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="29" data-gr-id="29">Azure</g> subscription with my personal account (hotmail</em></strong><strong><em>) so I had to use my company account subscription to make this work. </em></strong></p>
<!-- /wp:paragraph -->
<!-- wp:heading -->
<h2 id="mce_30">Step 4: Write the code to access data</h2>
<!-- /wp:heading -->
<!-- wp:paragraph -->
<p>Now we are all set up write our code that reads from the Model. Please refer to the entire source code in my <a href="https://github.com/sanjaybhagia/azure-analysis-services-netcore-sample" target="_blank">GitHub <g class="gr_ gr_4 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="4" data-gr-id="4">respository</g></a></p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Important method here <em>GetAccessToken.</em> I'm using ADAL.Net (<g class="gr_ gr_11 gr-alert gr_spell gr_inline_cards gr_disable_anim_appear ContextualSpelling ins-del multiReplace" id="11" data-gr-id="11">nuget</g>: <em>Microsoft.IdentityModel.Clients.ActiveDirectory</em>) to grab the token for the service principal from Azure AD<em>.</em> </p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":607,"linkDestination":"custom"} -->
<figure class="wp-block-image"><a href="https://github.com/sanjaybhagia/azure-analysis-services-netcore-sample/blob/master/ConsoleApp/ConsoleApp/Program.cs"><img src="/images/image-12.png" alt="" class="wp-image-607"/></a><figcaption>Method to acquire token from Azure AD to access analysis services</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Once we have the token, we are good to access data from the model. Here I'm using the unofficial NuGet package for ADOMD.NET that I mentioned previously.  The correct  Connection String format is: </p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>“<strong>Provider=MSOLAP;Data Source=&lt;url of the Azure Analysis Server>;Initial Catalog=&lt;modelname>;User ID=;Password=&lt;access token here>;Persist Security Info=True;Impersonation Level=Impersonate</strong>“</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>User ID is left empty and Password is the access token which we get from Azure AD. </p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":606,"linkDestination":"custom"} -->
<figure class="wp-block-image"><a href="https://github.com/sanjaybhagia/azure-analysis-services-netcore-sample/blob/master/ConsoleApp/ConsoleApp/Program.cs"><img src="/images/image-11.png" alt="" class="wp-image-606"/></a><figcaption>Method to read data from Analysis Services Model <em>adventureworks</em></figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>If you run this, you will see the output in <g class="gr_ gr_35 gr-alert sel gr_gramm gr_replaced gr_inline_cards gr_disable_anim_appear Grammar only-ins doubleReplace replaceWithoutSep" id="35" data-gr-id="35">the </g>console</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":605} -->
<figure class="wp-block-image"><img src="/images/image-10.png" alt="" class="wp-image-605"/><figcaption>Final output of the program</figcaption></figure>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Have you tried to work with Azure Analysis services in .NET Core? How was your experience? I would be very interested in listening to your experience and challenges.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Cheers</p>
<!-- /wp:paragraph -->
                </div>       
        <ul class="pager">
            <li class="previous">                
            </li>
            <li class="next">
            </li>
        </ul>
    </div>
    <div class="col-sm-4 sidebar">
        <hr class="visible-xs-block" />

            <h5>Tags</h5>
            <div>
                    <a role="button" href="/tags/personal-site" class="btn btn-default btn-sm"> Personal Site (3)</a>
                    <a role="button" href="/tags/azure" class="btn btn-default btn-sm"> azure (3)</a>
                    <a role="button" href="/tags/delegate-controls" class="btn btn-default btn-sm"> Delegate Controls (2)</a>
                    <a role="button" href="/tags/user-profile" class="btn btn-default btn-sm"> User Profile (2)</a>
                    <a role="button" href="/tags/workflow-association" class="btn btn-default btn-sm"> Workflow Association (2)</a>
                    <a role="button" href="/tags/sharepoint" class="btn btn-default btn-sm"> SharePoint (2)</a>
                    <a role="button" href="/tags/baseid" class="btn btn-default btn-sm"> BaseId (2)</a>
                    <a role="button" href="/tags/personalspace" class="btn btn-default btn-sm"> PersonalSpace (2)</a>
                    <a role="button" href="/tags/lcid" class="btn btn-default btn-sm"> LCID (2)</a>
                    <a role="button" href="/tags/workflow-templates" class="btn btn-default btn-sm"> Workflow Templates (2)</a>
            </div>
            <ul class="pager">
                <li class="next">
                    <a href="/tags">View All Tags &rarr;</a>
                </li>
            </ul>

            <hr />
            <h5>Older Posts</h5>
            <ul class="list-unstyled">
                    <li><a href="/2018/10/are-you-keeping-your-secrets-secret">Are you keeping your secrets secret?</a></li>
                    <li><a href="/2015/01/identifying-the-owner-of-personal-sites-in-sharepoint">Identifying the owner of personal sites in SharePoint</a></li>
                    <li><a href="/2015/01/deleting-managed-metadata-fields-via-powershell">Deleting Managed Metadata Fields via PowerShell</a></li>
                    <li><a href="/2014/08/using-httphandler-to-deal-with-cross-domain-requests-from-angularjs-app-for-sharepoint-on-premises">Using HttpHandler to deal with cross-domain requests from AngularJS app for SharePoint on-premises</a></li>
            </ul>
                <ul class="pager">
                    <li class="next">
                        <a href="/posts">Archive &rarr;</a>
                    </li>
                </ul>

        <hr />
<h5>Follow me</h5>

<ul class="list-inline text-center">
    <li>
    <a href="https://twitter.com/bhagiasanjay">
            <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
            </span>
    </a>
    </li>
    <li>
    <a href="https://github.com/sanjaybhagia">
            <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
            </span>
    </a>
    </li>
    <li>
    <a href="https://www.linkedin.com/in/sanjaybhagia/">
            <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
    </a>
    </li>
</ul>
    </div> 
</div>

                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/bhagiasanjay">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/sanjaybhagia">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://www.linkedin.com/in/sanjaybhagia/">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">                        
                        This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/rss.xml"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.xml"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/sanjaybhagia/sanjaybhagia.com"><i class="fa fa-github"></i> This Site on GitHub</a> | <a href="https://wyam.io">Generated by Wyam</a>
                </p>
                </div>
        </div>
</div>
                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>
        </body>
</html>
