
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Sanjay Bhagia&#x27;s Blog - Update Personal Site Property in User Profile</title>
        <meta name="description" content="Sanjay Bhagia" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link type="application/rss+xml" rel="alternate" title="Sanjay Bhagia&#x27;s Blog" href="/rss.xml" />
                <link type="application/atom+xml" rel="alternate" title="Sanjay Bhagia&#x27;s Blog" href="/feed.xml" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Sanjay Bhagia&#x27;s Blog" />
        <meta name="msapplication-tooltip" content="Sanjay Bhagia&#x27;s Blog" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:site_name" content="Sanjay Bhagia&#x27;s Blog" />
        <meta property="og:title" content="Update Personal Site Property in User Profile" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://sanjaybhagia.com/2013/03/update-personal-site-property-in-user-profile" />
                        <meta property="og:description" content="User Profile has one property called PersonalScope that stores the URL of the personal site of&amp;nbsp;user (if mysite is enabled for users). When user creates personal site, this property is set. Recently we had some problem in our environment with user profile synchronization that removed some of the information for user profiles and Personal Site was one of them. The impact of this was that when affected users navigate to their personal site (&quot;My Content&quot;) they get the message that personal site hasn&#x27;t been created yet. On checking the site collections for my site web application in Central Administration, the site collections for users were present. So it was just the linkage that was broken." />

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>
        <script src="/assets/js/highlight.pack.js"></script>
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <!-- <script src="/assets/js/background-check.min.js"></script> -->
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Sanjay Bhagia&#x27;s Blog</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About Me</a></li>
<li><a href="/posts">Archive</a></li>
<li><a href="/tags">Tags</a></li>
<li><a href="/tools">Tools</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Update Personal Site Property in User Profile</h1>
    <div class="meta">        
Published on Wednesday, 6 March 2013<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/my-site" class="btn btn-default btn-xs">My Site</a>
                    <a role="button" href="/tags/personal-site" class="btn btn-default btn-xs">Personal Site</a>
                    <a role="button" href="/tags/personalspace" class="btn btn-default btn-xs">PersonalSpace</a>
                    <a role="button" href="/tags/user-profile" class="btn btn-default btn-xs">User Profile</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>User Profile has one property called PersonalScope that stores the URL of the personal site of user (if mysite is enabled for users). When user creates personal site, this property is set. Recently we had some problem in our environment with user profile synchronization that removed some of the information for user profiles and Personal Site was one of them. The impact of this was that when affected users navigate to their personal site (&quot;My Content&quot;) they get the message that personal site hasn't been created yet. On checking the site collections for my site web application in Central Administration, the site collections for users were present. So it was just the linkage that was broken.</p>
<p>It is as simple as updating the User Profile's Personal Site property with proper relative URL of the site collection, but if many users are affected then PowerShell is the way to go!</p>
<p>Here is the scrip that i wrote to fix this linkage. I basically, went through all the site collections (in My Site Web Application) and fetched the user profile for every site and checked if Personal Site is null, simply update it with relative URL.</p>
<pre><code class="ps">Add-PSSnapin &quot;Microsoft.SharePoint.PowerShell&quot;

#This function resets the link to personal site for users who have personal site created but the link has been removed from user profile
Function UpdatePersonalSiteLinks($webApplicationUrl)
{
   #Instantiate Web Application Object
   $webApplication = Get-SPWebApplication -Identity $webApplicationUrl
   
   #Create Service Context for User Profile Manager
   $context = Get-SPServiceContext $webApplication.Sites[0]

   #Get User Profile Manager instance
   $profileManager = new-object Microsoft.Office.Server.UserProfiles.UserProfileManager($context)
   [Microsoft.SharePoint.SPSecurity]::RunWithElevatedPrivileges(
   {
     #Iterate through site collection in My Site Host web application
     foreach($siteCol in $webApplication.Sites)
     {
          Write-Host &quot;Site: &quot; $siteCol.Url

          #Get the user profile for owner of the personal site
          $uProfile = $profileManager.GetUserProfile($siteCol.Owner.LoginName)

          #Check if user profile has reference to personal site
          if($uProfile.PersonalSite -eq $null)
          {
             #If link has been removed, update the user profile
             Write-Host -ForegroundColor Red &quot;Personal Site is not linked&quot;
             Write-Host -ForegroundColor Green &quot;Updating the link&quot; $siteCol.RootWeb.ServerRelativeUrl

             #update the property (&quot;PersonalSpace&quot;)
             $uProfile[&quot;PersonalSpace&quot;].Value = $siteCol.RootWeb.ServerRelativeUrl
             $uProfile.Commit()
          }
     }
   })
}

UpdatePersonalSiteLinks &quot;http://mysite.local.domain/&quot;
</code></pre>
<p>It is important to run this script under right context, otherwise it might fail (to fetch the personal sites or updating the user profiles). That is why i have used RunWithElevatedPrivileges, however this might not be sufficient in your environment. So be sure you execute this script with right user credentials.</p>


<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'sanjaybhagia';
    var disqus_identifier = 'update-personal-site-property-in-user-profile';
    var disqus_title = 'Update Personal Site Property in User Profile';
    var disqus_url = 'http://sanjaybhagia.com/2013/03/update-personal-site-property-in-user-profile';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/bhagiasanjay">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/sanjaybhagia">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://www.linkedin.com/in/sanjaybhagia/">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">                        
                        This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/rss.xml"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.xml"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/sanjaybhagia/sanjaybhagia.com"><i class="fa fa-github"></i> This Site on GitHub</a> | <a href="https://wyam.io">Generated by Wyam</a>
                </p>
                </div>
        </div>
</div>
                </footer> 

                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>
        </body>
</html>
